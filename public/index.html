<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1000 Hours 7 Years</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
    <div class="container">
        <h1 class="mt-4">1000 Hours 7 Years</h1>

        <div id="content">
            <!-- Rows will be dynamically added here -->
        </div>
    </div>
    <script>
        // Simulated data for demonstration
        let rowsData = [
            { id: 1, checked: false, notes: '' },
            // ... more data
        ];

        const defaultRowsData = [];
        const numberOfRows = 1000;
        for (let i = 1; i <= numberOfRows; i++) {
            defaultRowsData.push({ id: i, checked: false, notes: '' });
        }

        // Function to generate a row element
    //     function generateRow(rowData) {
    //         return `
    //     <div class="row">
    //       <input type="checkbox" class="checkbox" data-id="${rowData.id}" ${rowData.checked ? 'checked' : ''}>
    //       <textarea class="notes" data-id="${rowData.id}">${rowData.notes}</textarea>
    //     </div>
    //   `;
    //     }

        
        function generateRow(rowData) {
            return `
                <div class="row-container border border-success rounded p-2 mb-2">
                    <div class="row">
                        <div class="col">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input checkbox" data-id="${rowData.id}" ${rowData.checked ? 'checked' : ''}>
                                <label class="form-check-label">Hour ${rowData.id}</label> <!-- Display hours number -->
                            </div>
                        </div>
                        <div class="col">
                            <textarea class="form-control notes" data-id="${rowData.id}">${rowData.notes}</textarea>
                        </div>
                    </div>
                </div>
            `;
        }

        // Function to populate rows on the page


        function populateRows(data) {
            const content = $('#content');
            content.empty();
            data.forEach(rowData => {
                content.append(generateRow(rowData));
            });
        }

        // Save data when checkbox or textarea changes
        function autoSave() {
            $('.checkbox, .notes').on('change', function () {
                const id = $(this).data('id');
                const checked = $(`.checkbox[data-id="${id}"]`).prop('checked');
                const notes = $(`.notes[data-id="${id}"]`).val();

                const index = rowsData.findIndex(row => row.id === id);
                if (index !== -1) {
                    rowsData[index].checked = checked;
                    rowsData[index].notes = notes;

                    // Simulated function to save data to server
                    saveDataToServer(id, checked, notes);
                }
            });
        }

        // Simulated function to save data to the server
        // Function to save data to the server
        function saveDataToServer(id, checked, notes) {
            // Simulated function to send data to server
            const dataToSend = JSON.stringify({
                checked: checked,
                notes: notes
            });
            $.ajax({
                url: '/api/data/' + id,
                method: 'PUT',
                contentType: 'application/json', // Specify JSON content type
                data: dataToSend,
                success: function (response) {
                    console.log(response);
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }

        $(document).ready(function () {
            populateRows(defaultRowsData);
            autoSave();
            $.ajax({
                url: '/api/data',
                method: 'GET',
                success: function (serverData) {
                    // If server data is empty, use default data
                    // const dataToPopulate = serverData.length > 0 ? serverData : defaultRowsData;
                    if(serverData.length > 0 ) {
                        rowsData = serverData;
                        populateRows(rowsData);
                        autoSave();
                    }
                },
                error: function (error) {
                    console.error(error);
                }
            });
        });


    </script>
</body>

</html>